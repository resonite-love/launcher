# プラグイン機能 設計計画書

## 概要

Resonite Launcherにプラグインシステムを追加し、Resoniteに有用な機能をオンオフで管理できるようにする。

## UI配置

既存のナビゲーション（ホーム、プロファイル管理、設定）に「プラグイン」タブを追加。

```
[ホーム] [プロファイル管理] [設定] [プラグイン]
```

---

# WebSocketリレー プラグイン 要件定義

## 概要

ユーザー間でWebSocket接続をトンネリングする機能。NAT越えが必要なため、中継サーバーを介して通信する。

## ユースケース

1. **ホストユーザー**がローカルで動作しているWebSocketサーバー（例：`ws://localhost:49994`）を外部に公開したい
2. **クライアントユーザー**が自分の`localhost`経由でホストのWebSocketに接続したい
3. 両者はNATの内側にいるため、直接接続できない

## システム構成

```
                                                   ┌─────────────────┐
                                                   │ クライアントA    │
                                                   │ ws://localhost: │
                                                   │ 33333           │
                                                   └────────┬────────┘
                                                            │
┌─────────────────┐      ┌─────────────────┐               │
│  ホストユーザー   │      │   中継サーバー    │◄──────────────┤
│                 │      │   (自前VPS)      │               │
│ ┌─────────────┐ │      │                 │               │
│ │ WSサーバー    │ │      │  ┌───────────┐  │      ┌────────┴────────┐
│ │ ws://       │ │      │  │  Tunnel   │  │      │ クライアントB    │
│ │ localhost:  │◄├──────┤  │ (1ホスト:  │  │◄─────┤ ws://localhost: │
│ │ 49994       │ │      │  │  N client) │  │      │ 33333           │
│ └─────────────┘ │      │  └───────────┘  │      └─────────────────┘
│       ▲         │      │                 │
│       │         │      │                 │      ┌─────────────────┐
│ ┌─────┴───────┐ │      │                 │◄─────┤ クライアントC    │
│ │ ランチャー    │◄├─────►│                 │      │ ws://localhost: │
│ └─────────────┘ │  WS  │                 │      │ 33333           │
└─────────────────┘      └─────────────────┘      └─────────────────┘
```

**ポイント:**
- 1つのホストに複数クライアントが接続可能
- 中継サーバーがメッセージをブロードキャスト/ルーティング

## フロー

### ホスト側（公開する側）

1. プラグイン画面で「ホストとして公開」を選択
2. 宛先WebSocketアドレスを入力（例：`ws://localhost:49994`）
3. 「公開開始」ボタンを押す
4. ランチャーが中継サーバーに接続、トンネルを作成
5. **アクセスキー**が発行される（例：`abc123xyz`）
6. アクセスキーを相手に共有

### クライアント側（接続する側）

1. プラグイン画面で「接続」を選択
2. 受け取った**アクセスキー**を入力
3. 「接続開始」ボタンを押す
4. ランチャーが中継サーバー経由でホストに接続
5. ローカルにWebSocketサーバーが起動（例：`ws://localhost:33333`）
6. このアドレスをResonite等に設定して使用

## 中継サーバー仕様

### 役割
- ホストとクライアントの接続を中継
- アクセスキーによるセッション管理
- NAT越えを実現

### エンドポイント（案）

```
POST /api/tunnel/create
  - ホストがトンネルを作成
  - レスポンス: { "access_key": "abc123xyz", "tunnel_id": "..." }

POST /api/tunnel/join
  - クライアントがトンネルに参加
  - リクエスト: { "access_key": "abc123xyz" }

WebSocket /ws/tunnel/{tunnel_id}
  - 実際のデータ転送用WebSocket接続
  - ホスト・クライアント両方がここに接続
```

### 認証・セキュリティ
- アクセスキーは一時的なもの（有効期限あり？）
- 1つのアクセスキーで複数クライアント接続可能？
- レート制限

## ランチャー側実装

### ホストモード
1. 中継サーバーにトンネル作成リクエスト
2. 中継サーバーのWebSocketに接続
3. 宛先ローカルWebSocketに接続
4. 中継サーバー ⇔ ローカルWebSocket のデータを双方向転送

### クライアントモード
1. ローカルにWebSocketサーバーを起動（例：port 33333）
2. 中継サーバーにアクセスキーで参加リクエスト
3. 中継サーバーのWebSocketに接続
4. ローカルWebSocketサーバー ⇔ 中継サーバー のデータを双方向転送

## 決定事項

### 中継サーバー関連
- [x] ホスティング先: **自前VPS**
- [x] 認証方式: **アクセスキーのみ**
- [x] 複数クライアント対応: **必要**（1ホストに複数人が接続）
- [x] 実装言語: **Node.js**
- [x] アクセスキーの有効期限: **ホストが切断するまで有効**（セッションベース）
- [x] 同時接続数の上限: **なし**
- [x] プロトコル方式: **案C（仮想接続型）** - クライアントごとに独立したWS接続

## 未決定事項

### 中継サーバー関連
- [ ] トラフィック制限（必要なら後で）

### ランチャー側
- [ ] ローカルポートの自動/手動選択
- [ ] 複数トンネルの同時利用
- [ ] 接続状態の表示（バイト数、遅延など）
- [ ] エラーハンドリング（再接続など）

### プロトコル
- [ ] WebSocketのサブプロトコル
- [ ] バイナリ/テキストフレームの扱い
- [ ] ハートビート/Keep-alive

## 技術選定

### 中継サーバー
- **Node.js + ws**: 手軽に実装、デプロイが簡単

## 実装フェーズ（案）

### Phase 1: 基盤
- [ ] 中継サーバーの基本実装
- [ ] ランチャーに「プラグイン」タブ追加
- [ ] WebSocketリレーUIの実装

### Phase 2: ホスト機能
- [ ] トンネル作成
- [ ] アクセスキー表示
- [ ] ローカルWebSocketへの転送

### Phase 3: クライアント機能
- [ ] アクセスキー入力
- [ ] ローカルWebSocketサーバー起動
- [ ] 中継サーバーへの接続

### Phase 4: 安定化
- [ ] エラーハンドリング
- [ ] 再接続ロジック
- [ ] UI改善

---

# プロトコル詳細設計

## 設計方針の選択肢

### 案A: シンプル透過型
中継サーバーはWebSocketフレームをそのまま転送。クライアント識別はしない。

```
ホスト ←→ 中継サーバー ←→ クライアントA
                      ←→ クライアントB
```

- ホストのWSサーバーから見ると、全クライアントが1つの接続に見える
- ホストが送ったメッセージは全クライアントにブロードキャスト
- クライアントが送ったメッセージはホストに転送

**メリット**: 実装がシンプル、既存のWSサーバーをそのまま使える
**デメリット**: ホスト側でクライアントを識別できない

### 案B: クライアント識別型
各クライアントにIDを付与し、ホストがクライアントを識別できる。

```
メッセージ形式:
{
  "type": "data",
  "client_id": "abc123",
  "payload": <元のWSデータ>
}
```

**メリット**: ホストが特定クライアントにだけ返信可能
**デメリット**: ホストのWSサーバー側でプロトコルを解釈する必要がある

### 案C: 仮想接続型（推奨）
ホストのランチャーが各クライアントごとに別々のWS接続をローカルWSサーバーに張る。

```
クライアントA → 中継 → ホストランチャー → localhost:49994 (接続1)
クライアントB → 中継 → ホストランチャー → localhost:49994 (接続2)
```

**メリット**:
- ホストのWSサーバーから見ると通常の複数クライアント接続と同じ
- 既存のWSサーバーを変更不要
- クライアントごとに独立した接続

**デメリット**: ホストランチャー側の実装が少し複雑

---

## 推奨: 案C（仮想接続型）プロトコル詳細

### WebSocket接続構成

```
[クライアントA]                    [中継サーバー]                    [ホスト]
     │                                 │                              │
     │ ←──── WS接続 ────→              │                              │
     │   (リレー用)                     │ ←──── WS接続 ────→           │
     │                                 │   (リレー用)                  │
[クライアントB]                         │                              │
     │                                 │                              │
     │ ←──── WS接続 ────→              │                         localhost:49994
     │   (リレー用)                     │                              │
                                                                  [WSサーバー]
```

### 接続フロー

#### 1. ホストがトンネル作成

```
ホスト → 中継サーバー (WS接続確立後)
{
  "type": "create_tunnel",
  "target": "ws://localhost:49994"
}

中継サーバー → ホスト
{
  "type": "tunnel_created",
  "access_key": "abc123xyz",
  "tunnel_id": "tunnel_xxxxx"
}
```

#### 2. クライアントがトンネル参加

```
クライアント → 中継サーバー (WS接続確立後)
{
  "type": "join_tunnel",
  "access_key": "abc123xyz"
}

中継サーバー → クライアント
{
  "type": "tunnel_joined",
  "tunnel_id": "tunnel_xxxxx"
}

中継サーバー → ホスト（新クライアント通知）
{
  "type": "client_connected",
  "client_id": "client_yyyyy"
}

ホストランチャー: localhost:49994 に新しいWS接続を作成
```

#### 3. データ転送

```
クライアント → 中継サーバー
{
  "type": "data",
  "payload": "<base64 or UTF-8>",
  "binary": false
}

中継サーバー → ホスト
{
  "type": "data",
  "client_id": "client_yyyyy",
  "payload": "<base64 or UTF-8>",
  "binary": false
}

ホストランチャー: client_yyyyy用のWS接続にデータを送信
```

```
ホストのWSサーバー → ホストランチャー (client_yyyyy用接続で受信)

ホスト → 中継サーバー
{
  "type": "data",
  "client_id": "client_yyyyy",
  "payload": "<base64 or UTF-8>",
  "binary": false
}

中継サーバー → クライアント（該当client_idのみ）
{
  "type": "data",
  "payload": "<base64 or UTF-8>",
  "binary": false
}
```

#### 4. クライアント切断

```
クライアントがWS切断 or 明示的切断

中継サーバー → ホスト
{
  "type": "client_disconnected",
  "client_id": "client_yyyyy"
}

ホストランチャー: client_yyyyy用のWS接続をクローズ
```

#### 5. ホスト切断

```
ホストがWS切断 or 明示的切断

中継サーバー → 全クライアント
{
  "type": "tunnel_closed",
  "reason": "host_disconnected"
}

中継サーバー: トンネル削除、アクセスキー無効化
```

### メッセージ型一覧

| type | 方向 | 説明 |
|------|------|------|
| `create_tunnel` | ホスト→サーバー | トンネル作成要求 |
| `tunnel_created` | サーバー→ホスト | トンネル作成完了 |
| `join_tunnel` | クライアント→サーバー | トンネル参加要求 |
| `tunnel_joined` | サーバー→クライアント | トンネル参加完了 |
| `client_connected` | サーバー→ホスト | 新クライアント接続通知 |
| `client_disconnected` | サーバー→ホスト | クライアント切断通知 |
| `tunnel_closed` | サーバー→クライアント | トンネル終了通知 |
| `data` | 双方向 | データ転送 |
| `error` | サーバー→両方 | エラー通知 |

### バイナリデータの扱い

WebSocketはテキストとバイナリの両方をサポート。選択肢:

**案1: 全てJSONでラップ（バイナリはBase64）**
```json
{
  "type": "data",
  "client_id": "xxx",
  "payload": "SGVsbG8gV29ybGQ=",
  "binary": true
}
```
- 実装シンプル
- オーバーヘッド約33%増

**案2: 制御はJSON、データはそのまま転送**
- 最初の1バイトでメッセージ種別判定
- `0x00` = 制御メッセージ（JSON）
- `0x01` = データ（後続バイトがclient_id長 + client_id + ペイロード）
- 効率的だが実装複雑

**推奨: 案1（JSON + Base64）**
- まず動くものを作る
- パフォーマンス問題が出たら案2に移行

### エラーメッセージ

```json
{
  "type": "error",
  "code": "INVALID_ACCESS_KEY",
  "message": "Access key not found or expired"
}
```

エラーコード:
- `INVALID_ACCESS_KEY`: アクセスキーが無効
- `TUNNEL_NOT_FOUND`: トンネルが存在しない
- `HOST_DISCONNECTED`: ホストが切断された
- `INTERNAL_ERROR`: サーバー内部エラー

### Keep-alive

```json
{
  "type": "ping"
}

{
  "type": "pong"
}
```

30秒ごとにping/pongで接続維持。60秒応答なしで切断。

---

# 通信仕様書 (詳細)

## 概要

| 項目 | 値 |
|------|-----|
| プロトコル | WebSocket (RFC 6455) |
| データ形式 | JSON (UTF-8) |
| バイナリデータ | Base64エンコード |
| サーバーURL | `wss://wsproxy.kokoa.dev/ws` |
| ヘルスチェック | `https://wsproxy.kokoa.dev/health` |

## 接続シーケンス

### ホスト側シーケンス

```
ホスト                          中継サーバー
  │                                  │
  │──── WebSocket接続 ────────────────>│
  │                                  │
  │──── create_tunnel ───────────────>│
  │                                  │
  │<─── tunnel_created ───────────────│
  │     (access_key, tunnel_id)      │
  │                                  │
  │     ... クライアント接続待ち ...    │
  │                                  │
  │<─── client_connected ─────────────│
  │     (client_id)                  │
  │                                  │
  │<─── data ─────────────────────────│
  │     (client_id, payload)         │
  │                                  │
  │──── data ─────────────────────────>│
  │     (client_id, payload)         │
  │                                  │
```

### クライアント側シーケンス

```
クライアント                      中継サーバー
  │                                  │
  │──── WebSocket接続 ────────────────>│
  │                                  │
  │──── join_tunnel ─────────────────>│
  │     (access_key)                 │
  │                                  │
  │<─── tunnel_joined ────────────────│
  │     (tunnel_id)                  │
  │                                  │
  │──── data ─────────────────────────>│
  │     (payload)                    │
  │                                  │
  │<─── data ─────────────────────────│
  │     (payload)                    │
  │                                  │
```

## メッセージ仕様

### 共通フィールド

全メッセージに必須:
```typescript
{
  type: string;  // メッセージタイプ
}
```

### 1. create_tunnel (ホスト→サーバー)

トンネル作成リクエスト。

```typescript
{
  type: "create_tunnel";
  target: string;  // 転送先アドレス (例: "ws://localhost:49994")
}
```

**例:**
```json
{
  "type": "create_tunnel",
  "target": "ws://localhost:49994"
}
```

### 2. tunnel_created (サーバー→ホスト)

トンネル作成成功レスポンス。

```typescript
{
  type: "tunnel_created";
  tunnel_id: string;    // トンネル識別子 (UUID)
  access_key: string;   // アクセスキー (8文字英数字)
}
```

**例:**
```json
{
  "type": "tunnel_created",
  "tunnel_id": "550e8400-e29b-41d4-a716-446655440000",
  "access_key": "AB3CD5"
}
```

**アクセスキー形式:**
- 6桁
- 英大文字 + 数字（紛らわしい文字除外: 0/O, 1/I/L）
- 使用文字: `ABCDEFGHJKMNPQRSTUVWXYZ23456789`
- 口頭で伝えやすい形式

### 3. join_tunnel (クライアント→サーバー)

トンネル参加リクエスト。

```typescript
{
  type: "join_tunnel";
  access_key: string;  // ホストから共有されたアクセスキー
}
```

**例:**
```json
{
  "type": "join_tunnel",
  "access_key": "AB3CD5"
}
```

### 4. tunnel_joined (サーバー→クライアント)

トンネル参加成功レスポンス。

```typescript
{
  type: "tunnel_joined";
  tunnel_id: string;  // 参加したトンネルのID
}
```

**例:**
```json
{
  "type": "tunnel_joined",
  "tunnel_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 5. client_connected (サーバー→ホスト)

新しいクライアントがトンネルに参加した通知。

```typescript
{
  type: "client_connected";
  client_id: string;  // クライアント識別子 (UUID)
}
```

**例:**
```json
{
  "type": "client_connected",
  "client_id": "660e8400-e29b-41d4-a716-446655440001"
}
```

### 6. client_disconnected (サーバー→ホスト)

クライアントがトンネルから切断した通知。

```typescript
{
  type: "client_disconnected";
  client_id: string;  // 切断したクライアントのID
  reason: string;     // 切断理由
}
```

**例:**
```json
{
  "type": "client_disconnected",
  "client_id": "660e8400-e29b-41d4-a716-446655440001",
  "reason": "connection_closed"
}
```

**切断理由:**
- `connection_closed`: 正常切断
- `timeout`: タイムアウト
- `error`: エラー発生

### 7. data (双方向)

データ転送メッセージ。

**ホスト→サーバー (特定クライアント宛):**
```typescript
{
  type: "data";
  client_id: string;  // 送信先クライアントID
  payload: string;    // データ (テキストまたはBase64)
  binary: boolean;    // true=Base64エンコード済みバイナリ
}
```

**サーバー→ホスト (クライアントからのデータ):**
```typescript
{
  type: "data";
  client_id: string;  // 送信元クライアントID
  payload: string;
  binary: boolean;
}
```

**クライアント→サーバー:**
```typescript
{
  type: "data";
  payload: string;
  binary: boolean;
}
```

**サーバー→クライアント:**
```typescript
{
  type: "data";
  payload: string;
  binary: boolean;
}
```

**例 (テキスト):**
```json
{
  "type": "data",
  "client_id": "660e8400-e29b-41d4-a716-446655440001",
  "payload": "Hello, World!",
  "binary": false
}
```

**例 (バイナリ):**
```json
{
  "type": "data",
  "client_id": "660e8400-e29b-41d4-a716-446655440001",
  "payload": "SGVsbG8sIFdvcmxkIQ==",
  "binary": true
}
```

### 8. tunnel_closed (サーバー→クライアント)

トンネルが閉じられた通知。

```typescript
{
  type: "tunnel_closed";
  reason: string;  // 閉じられた理由
}
```

**例:**
```json
{
  "type": "tunnel_closed",
  "reason": "host_disconnected"
}
```

**理由:**
- `host_disconnected`: ホストが切断
- `host_closed`: ホストが明示的に閉じた

### 9. close_tunnel (ホスト→サーバー)

トンネルを明示的に閉じる。

```typescript
{
  type: "close_tunnel";
}
```

### 10. error (サーバー→両方)

エラー通知。

```typescript
{
  type: "error";
  code: string;     // エラーコード
  message: string;  // 人間が読めるメッセージ
}
```

**例:**
```json
{
  "type": "error",
  "code": "INVALID_ACCESS_KEY",
  "message": "Access key not found or expired"
}
```

**エラーコード一覧:**

| コード | 説明 |
|--------|------|
| `INVALID_ACCESS_KEY` | アクセスキーが無効 |
| `TUNNEL_NOT_FOUND` | トンネルが存在しない |
| `TUNNEL_FULL` | トンネルが満員 (将来用) |
| `INVALID_MESSAGE` | メッセージ形式が不正 |
| `INTERNAL_ERROR` | サーバー内部エラー |

### 11. ping / pong (双方向)

Keep-alive用。

```typescript
{
  type: "ping";
}

{
  type: "pong";
}
```

**タイミング:**
- クライアント/ホストは30秒ごとにpingを送信
- サーバーはpingを受けたらpongを返す
- 60秒間通信がなければ接続を切断

## サーバー内部状態

```typescript
interface Tunnel {
  id: string;           // UUID
  accessKey: string;    // 8文字
  hostWs: WebSocket;    // ホストのWebSocket接続
  target: string;       // 転送先アドレス
  clients: Map<string, WebSocket>;  // client_id -> WebSocket
  createdAt: Date;
}

// メモリ上で管理
const tunnels: Map<string, Tunnel> = new Map();  // tunnel_id -> Tunnel
const accessKeyToTunnel: Map<string, string> = new Map();  // access_key -> tunnel_id
```

## HTTPエンドポイント

| パス | メソッド | 説明 |
|------|----------|------|
| `/` | GET | サーバー情報・エンドポイント一覧 |
| `/health` | GET | ヘルスチェック |
| `/stats` | GET | 詳細統計情報 |
| `/ws` | WebSocket | WebSocket接続エンドポイント |

### GET /
```json
{
  "name": "ws-relay-server",
  "version": "1.0.0",
  "endpoints": {
    "websocket": "/ws",
    "health": "/health",
    "stats": "/stats"
  }
}
```

### GET /health
```json
{
  "status": "ok",
  "tunnels": 5,
  "clients": 12,
  "uptime": 3600.5
}
```

### GET /stats
```json
{
  "tunnels": 5,
  "clients": 12,
  "uptime": 3600.5,
  "memory": {
    "rss": 45678592,
    "heapTotal": 12345678,
    "heapUsed": 9876543
  },
  "version": "1.0.0"
}

## セキュリティ考慮事項

1. **TLS必須**: 本番環境ではwss://を使用
2. **アクセスキー**: 推測困難な8文字ランダム生成
3. **レート制限**: 同一IPからの接続数を制限 (将来実装)
4. **入力検証**: 全メッセージをJSON schemaで検証

---

# UI設計

## ナビゲーション

既存タブに「プラグイン」を追加:

```
[🏠 ホーム] [👤 プロファイル管理] [⚙️ 設定] [🔌 プラグイン]
```

アイコン: `Plug` (lucide-react)

## プラグインタブ レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│  🔌 プラグイン                                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ WebSocket リレー                                         │   │
│  │                                                         │   │
│  │ ユーザー間でWebSocket接続を共有します                      │   │
│  │                                                         │   │
│  │  ○ ホスト（公開する）    ○ クライアント（接続する）         │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ═══════════════════════════════════════════════════════════   │
│                                                                 │
│  【ホストモード選択時】                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 宛先アドレス                                             │   │
│  │ ┌─────────────────────────────────────────────────────┐ │   │
│  │ │ ws://localhost:49994                                │ │   │
│  │ └─────────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  │ [🚀 公開開始]                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  【公開中の表示】                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✅ 公開中                                               │   │
│  │                                                         │   │
│  │ アクセスキー                                             │   │
│  │ ┌───────────────────────────────────┐ [📋 コピー]       │   │
│  │ │ abc123xyz                         │                   │   │
│  │ └───────────────────────────────────┘                   │   │
│  │                                                         │   │
│  │ 接続中のクライアント: 2                                   │   │
│  │  • client_aaaa (接続中)                                 │   │
│  │  • client_bbbb (接続中)                                 │   │
│  │                                                         │   │
│  │ [⏹️ 公開停止]                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────────────────┐
│  【クライアントモード選択時】                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ アクセスキー                                             │   │
│  │ ┌─────────────────────────────────────────────────────┐ │   │
│  │ │ abc123xyz                                           │ │   │
│  │ └─────────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  │ ローカルポート (任意)                                    │   │
│  │ ┌─────────────────────────────────────────────────────┐ │   │
│  │ │ 33333                                               │ │   │
│  │ └─────────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  │ [🔗 接続]                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  【接続中の表示】                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✅ 接続中                                               │   │
│  │                                                         │   │
│  │ 接続先アドレス（これを使用してください）                    │   │
│  │ ┌───────────────────────────────────┐ [📋 コピー]       │   │
│  │ │ ws://localhost:33333              │                   │   │
│  │ └───────────────────────────────────┘                   │
│  │                                                         │   │
│  │ ステータス: 接続済み                                      │   │
│  │                                                         │   │
│  │ [🔌 切断]                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 状態遷移

### ホストモード
```
[未接続] --公開開始--> [接続中...] --成功--> [公開中]
                          |                    |
                          v                    v
                       [エラー]          --停止--> [未接続]
```

### クライアントモード
```
[未接続] --接続--> [接続中...] --成功--> [接続済み]
                      |                    |
                      v                    v
                   [エラー]          --切断--> [未接続]
```

## エラー表示

```
┌─────────────────────────────────────────────────────────────────┐
│ ❌ 接続エラー                                                    │
│                                                                 │
│ アクセスキーが無効または期限切れです                                │
│                                                                 │
│ [再試行]                                                        │
└─────────────────────────────────────────────────────────────────┘
```

## コンポーネント構成

```
PluginsTab.tsx
├── WebSocketRelayPlugin.tsx (プラグイン本体)
│   ├── HostMode.tsx (ホストモードUI)
│   └── ClientMode.tsx (クライアントモードUI)
└── (将来の他プラグイン)
```

## 次のステップ

1. ~~中継サーバーのプロトコル詳細設計~~ ✅
2. ~~ランチャーUIのワイヤーフレーム~~ ✅
3. 実装開始
   - [ ] 中継サーバー (Node.js)
   - [ ] ランチャーUI (プラグインタブ追加)
   - [ ] ランチャーバックエンド (Tauri/Rust)
